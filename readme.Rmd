---
title: "readme"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Prerequisites

Before installing FLfse, the following non-CRAN R packages should be installed:

* stockassessment (available from https://github.com/fishfollower/SAM)
* spict (available from https://github.com/mawp/spict/)
* FLR packages FLCore and ggplotFL (see http://www.flr-project.org/#install)

## Install FLfse

FLfse can be installed with
```{R, eval = FALSE}
devtools::install_github("shfischer/FLfse/FLfse")
```
## Showcase functionality
load package
```{r}
library(FLfse)
```
The package includes example data for some stocks, see
```{R, eval = FALSE}
data(package = "FLfse")
```
Currently, this includes the 2017 assessment for Irish Sea plaice, the 2018 assessments for North Sea cod, North Sea haddock and North Sea whiting and the 2019 assessment for North Sea herring.

# Run stock assessments
## SAM
Fit SAM to North Sea cod data, with default parametrizations:
```{R}
fit <- FLR_SAM(stk = cod4_stk, idx = cod4_idx)
```
use the SAM assessment configuration as used by ICES WGNSSK 2018:
```{r}
### fit SAM model
fit <- FLR_SAM(stk = cod4_stk, idx = cod4_idx, conf = cod4_conf_sam)
### check convergence
fit$opt$convergence

### The result of FLR_SAM() is an object of class "sam". 
### All methods defined in the stockassessment package can be used on it.
### summary table
summary(fit)
### plot model
plot(fit)
### plot catch
catchplot(fit)
```
The resulting "sam" object can then be converted into an FLStock object:
```{R}
cod4 <- SAM2FLStock(fit, cod4_stk)
### plot with ggplotFL
library(ggplotFL)
plot(cod4)
```


## SPiCT
Another assessment method implemented is the Surplus Production in Continuous Time (SPiCT) model (Pedersen & Berg, 2017).

```{R}
library(spict)
### fit SPiCT to Irish Sea plaice
fit <- FLR_SPiCT(stk = ple7a_stk, idx = ple7a_idx)
### check results
fit
plot(fit)

### pass additional configuration, set time step to 1 per year
conf <- list(dteuler = 1)
fit2 <- FLR_SPiCT(stk = ple7a_stk, idx = ple7a_idx, conf = conf)
fit2
```

## SAM for North Sea herring
The HAWG assessment for North Sea herring can be replicated with `FLfse`.
To get this assessment running, a different branch ("components") of the `stockassessment` package needs to be installed.
The following code snippet shows how to do this without interfering with the global packages (please restart R if another version of stockassessment is currently loaded):

```{R, eval = FALSE}
### 1st: add a temporary R package library 
.libPaths(c(tempdir(), .libPaths()))
### 2nd: install stockassessment branch "components"
devtools::install_github("fishfollower/SAM/stockassessment", ref = "components")

### now, the assessment can be run:
library(FLfse)
library(stockassessment)
### replicate HAWG assessment
fit <- FLR_SAM(stk = her4_stk, idx = her4_idx, conf = her4_conf_sam, 
                    conf_full = TRUE, NA_rm = FALSE)
### check results
fit
plot(fit)
summary(fit)
### convert into FLStock
stk <- SAM2FLStock(fit, her4_stk)
```
